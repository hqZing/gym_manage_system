<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>首页</title>

    <!-- layUI框架的样式表 -->
    <link rel="stylesheet" href="./layui/css/layui.css" type="text/css" />

    <style>
        body{
            background-color: #d2d2d2;
        }
    </style>



</head>
<body>


<div class="layui-container">  
    <div class="layui-row">
        <div class="layui-col-md12">
            <ul class="layui-nav" lay-filter="">
                <li class="layui-nav-item layui-this"><a href="./index.html">首页</a></li>
                <li class="layui-nav-item"><a onclick="fun1()" >场地查询</a></li>
                <li class="layui-nav-item"><a >我的订单<span class="layui-badge">9</span></a></li>
                <li class="layui-nav-item"><a href="">体育新闻<span class="layui-badge-dot"></span></a></li>
                <li class="layui-nav-item"><a href="javascript:;">个人中心</a></li>
            </ul>
        </div>
    </div>
</div>


<!-- 首页 -->
<div id="pann1" class="pann">
<div class="layui-container">  
    <div class="layui-row">
        <div class="layui-col-md12">
            <div class="layui-carousel" id="test1">
                <div carousel-item>
                    <div><img src="./img/1.png"></div>
                    <div><img src="./img/2.png"></div>
                    <div><img src="./img/3.png"></div>
                    <div><img src="./img/4.png"></div>
                    <div><img src="./img/5.png"></div>
                </div>
            </div>
        </div>
    </div>


    <div class="layui-row layui-col-space10">
        <div class="layui-col-md9">
            <div class="layui-card">
                <div class="layui-card-header">当前场地使用状况总览</div>
                <div class="layui-card-body">
                    
                    <div>
                        <i class="layui-icon layui-icon-log"></i>   时间筛选 <div class="layui-inline"><input type="text" class="layui-input" id="DF6X71"></div><button class="layui-btn" onclick="summary()">确定</button>
                        <p> </p>
                        <p> </p>
                    </div><br>

                    <div id="MC2XH6">
                        <!-- 各种球场的使用量 -->
                    </div>
                    

                </div>
            </div>   
        </div>


        <div class="layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">最新预定</div>
                <div class="layui-card-body">
                    <ul class="layui-timeline" id="NG224C">

                        <li class="layui-timeline-item">
                            <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                            <div class="layui-timeline-content layui-text">
                            <h3 class="layui-timeline-title" id="JV2X4"></h3>
                            <p id="MJSF2"></p>
                            </div>
                        </li>

                        <li class="layui-timeline-item">
                            <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                            <div class="layui-timeline-content layui-text">
                            <h3 class="layui-timeline-title" id="OF1DD"></h3>
                            <p id="DTX7J"></p>
                            </div>
                        </li>

                        <li class="layui-timeline-item">
                            <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                            <div class="layui-timeline-content layui-text">
                            <h3 class="layui-timeline-title" id="NJXCK"></h3>
                            <p id="AL021"></p>
                            </div>
                        </li>


                        <li class="layui-timeline-item">
                            <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                            <div class="layui-timeline-content layui-text">
                            <div class="layui-timeline-title">查看全部</div>
                            </div>
                        </li>

                    </ul>
                </div>
            </div>   
        </div>
    </div>
</div>
</div>

<!-- 场地查询页面 -->
<div id="pann2" class="pann" style="display: none ">
<div class="layui-container">  
    <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
        <ul class="layui-tab-title" id="MV3T98">
            <!-- <li >篮球场</li>
            <li>排球场</li>
            <li>羽毛球场</li>
            <li>乒乓球场</li> -->
        </ul>

        
        <div class="layui-tab-content" style="height: 100px;" id="IJMSL">

           
            <!-- <div class="layui-tab-item layui-show layui-col-md3">
  
                <div class="layui-card">
                    <div class="layui-card-header">篮球场1</div>
                    <div class="layui-card-body">
                        一些描述
                        <br>
                        <button class="layui-btn  layui-btn-sm" onclick="fun2()">搜索</button>
                        <button class="layui-btn  layui-btn-sm layui-btn-warm">预定</button>
                    </div>
                </div>

                <div class="layui-card">
                    <div class="layui-card-header">篮球场1</div>
                    <div class="layui-card-body">
                        一些描述
                        <br>
                        <button class="layui-btn  layui-btn-sm" onclick="fun2()">搜索</button>
                        <button class="layui-btn  layui-btn-sm layui-btn-warm">预定</button>
                    </div>
                </div>
  
            </div>

           
            <div class="layui-tab-item layui-col-md3">
                <div class="layui-card">
                    <div class="layui-card-header">排球场1</div>
                    <div class="layui-card-body">
                        一些描述
                    </div>
                </div>
            </div>

            
            <div class="layui-tab-item layui-col-md3">
                <div class="layui-card">
                    <div class="layui-card-header">羽毛球场1</div>
                    <div class="layui-card-body">
                        一些描述
                    </div>
                </div>
            </div>

           
            <div class="layui-tab-item layui-col-md3">
                <div class="layui-card">
                    <div class="layui-card-header">乒乓球场1</div>
                    <div class="layui-card-body">
                        一些描述
                    </div>
                </div>
            </div> --> 

        </div>
    </div>      
            
</div>

</div>


<!-- 这里搞一个弹出框，用来查询特定场地的 -->
<div id="search_one">


</div>

        

    <!-- layUI框架的脚本 -->
    <script src="./layui/layui.all.js"></script>

    <!-- 导航栏 -->
    <script>

        //导航栏
        layui.use('element', function(){
            var element = layui.element;
        });

        //轮播
        layui.use('carousel', function(){
            var carousel = layui.carousel;
            //建造实例
            carousel.render({
                elem: '#test1'
                ,width: '100%' //设置容器宽度
                ,arrow: 'always' //始终显示箭头
                ,interval: 6000 //图片切换时常6000毫秒
                //,anim: 'updown' //切换动画方式
            });
        });

        //日期时间输入
        layui.use('laydate', function(){
            var laydate = layui.laydate;
            
            //执行一个laydate实例
            laydate.render({
                elem: '#DF6X71' //指定元素
                ,type: 'datetime'
            });
        });

        layui.use('form', function(){
            var form = layui.form;
            
        });

        layui.use('layer', function(){
            var layer = layui.layer;
            
            // layer.msg('hello');
        });        


        //页面逻辑
        pann1 = document.getElementById("pann1");
        pann2 = document.getElementById("pann2");
        panns = document.getElementsByClassName("pann")



        //场地查询按钮
        fun1 = function(){
            //清除页面，只保留导航栏
            for(i=0;i<panns.length;i++) panns[i].style.display = "none";
            pann2.style.display = "block";

            
            //进行一系列ajax操作
            field_info();
            
        }

 


            
        //summary
        summary = function(){

            time = document.getElementById("DF6X71").value

            console.log(time);
            if (time==""){
                time = "2019-05-06 13:00:00"
            }
            xmlhttp=new XMLHttpRequest();
            xmlhttp.open("GET","http://127.0.0.1/summary?time="+time,true);
            xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");

            xmlhttp.onreadystatechange = function(){

                // 在监听函数中，判断readyState=4 && status=200表示请求成功
                if(xmlhttp.readyState==4 && xmlhttp.status==200){
                    // 使用responseText、responseXML接受响应数据，并使用原生JS操作DOM进行显示
                    C1D53 = xmlhttp.responseText;
                    C1D53 = JSON.parse(C1D53)

                    console.log(C1D53);
                    temp_html = ""

        

                    //四种背景颜色轮流来
                    bgbg = ["layui-bg-orange", "layui-bg-blue", "layui-bg-red", "layui-bg-green"]
                    temp_ttt = 0
                    for (e in C1D53){
                        temp_html += e
                        temp_html +=
                        "<div class=\"layui-progress layui-progress-big\" lay-showPercent=\"true\">" +
                        "<div class=\"layui-progress-bar " + bgbg[temp_ttt] +"\" lay-percent=\""+C1D53[e]+"\"></div>" +
                        "</div><br>"
                    
                        console.log(e)
                        temp_ttt = (temp_ttt+1) %4
                    }

                    console.log(temp_html)

                    document.getElementById("MC2XH6").innerHTML = temp_html;

                    //更新完页面之后重新渲染
                    layui.use('element', function() {
                        var element = layui.element;
                        element.init();
                    });
                }
            }

            xmlhttp.send("");


        }
 

        // xmlhttp.onreadystatechange = function(){
        //         if(xmlhttp.readyState==4 && xmlhttp.status==200){
                    
        //         }
        //     }
        // }


        //最新预定
        latest = function(){

            xmlhttp=new XMLHttpRequest();
            xmlhttp.open("GET","http://127.0.0.1/latest",true);
            xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");

            xmlhttp.onreadystatechange = function(){
             
                if(xmlhttp.readyState==4 && xmlhttp.status==200){
                    HX5DE = xmlhttp.responseText;
                    HX5DE = JSON.parse(HX5DE)

                    console.log(HX5DE);

                                
                    document.getElementById("JV2X4").innerHTML =  HX5DE[0]["cmtime"]
                    document.getElementById("MJSF2").innerHTML =  "用户【" + HX5DE[0]["username"] +"】" +"预约了"+ HX5DE[0]["fieldname"]

                    document.getElementById("OF1DD").innerHTML =  HX5DE[1]["cmtime"]
                    document.getElementById("DTX7J").innerHTML =  "用户【" + HX5DE[1]["username"] +"】" +"预约了"+ HX5DE[1]["fieldname"]

                    document.getElementById("NJXCK").innerHTML =  HX5DE[2]["cmtime"]
                    document.getElementById("AL021").innerHTML =  "用户【" + HX5DE[2]["username"] +"】" +"预约了"+ HX5DE[2]["fieldname"]
                }
            }

            xmlhttp.send("");
                        
        }
 

        //场地查询
        field_info = function(){
            xmlhttp=new XMLHttpRequest();
            xmlhttp.open("GET","http://127.0.0.1/field_info",true);
            xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");

            xmlhttp.onreadystatechange = function(){
                if(xmlhttp.readyState==4 && xmlhttp.status==200){
                    HX5DE = xmlhttp.responseText;
                    HX5DE = JSON.parse(HX5DE)

                    console.log(HX5DE);

                    

                    temp_html = ""
                    temp_html2 = ""

                    for (e in HX5DE){
                        //标签标题
                        temp_html += "<li>" + e + "</li>" 

                        temp_html2 += "<div class=\"layui-tab-item layui-col-md3\">"

                        //分别添加标签页
                        for (i=0; i<HX5DE[e].length; i++){
                            temp_html2+= "<div class=\"layui-card\">"
                            + "<div class=\"layui-card-header\">" + HX5DE[e][i][2] + "</div>"
                            + "<div class=\"layui-card-body\">" + HX5DE[e][i][4] + "<br>价格为"+ HX5DE[e][i][3] +"<br>"//+ "<br>id为" + HX5DE[e][i][0] + "<br>"
                            + "<button class=\"layui-btn  layui-btn-sm\" onclick=\"qry("+ HX5DE[e][i][0] + ")\">查询</button>"
                            + "<button class=\"layui-btn  layui-btn-sm layui-btn-warm\" onclick=\"bookit("+ HX5DE[e][i][0] + ")\">预定</button>"
                            + "</div></div>"
                        }
                        temp_html2 += "</div>"

                    }
                    

                    document.getElementById("MV3T98").innerHTML =  temp_html
                    document.getElementById("IJMSL").innerHTML =  temp_html2

                    document.getElementById("MV3T98").children[0].className += 'layui-this'
                    document.getElementById("MV3T98").children[0].click()
                    // document.getElementById("IJMSL").children[0].className += 'layui-show'

                    
                    layui.use('element', function() {
                        var element = layui.element;
                        element.init();
                    });
                    
                }
                
            }


            xmlhttp.send("");

           
        }
  
        //查询场地占用状况。使用id查询
        qry = function(idid){
            console.log(idid)
            xmlhttp=new XMLHttpRequest();
            xmlhttp.open("GET","http://127.0.0.1/qry?idid="+idid,true);
            xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");

            xmlhttp.onreadystatechange = function(){
                if(xmlhttp.readyState==4 && xmlhttp.status==200){
                    
                    HX5DE = xmlhttp.responseText;
                    HX5DE = JSON.parse(HX5DE)

                    console.log(HX5DE);

                    temp_html = ""

                    temp_html += "<table class=\"layui-table\">"
                    +  "<thead><tr><th>用户</th><th>起始时间</th><th>结束时间</th><th>下单时间</th></tr></thead><tbody>"

                    for(i=0; i<HX5DE.length; i++){
                        temp_html += "<tr>"
                        + "<td>" + HX5DE[i][0] +"</td>"
                        + "<td>" + HX5DE[i][2] +"</td>"
                        + "<td>" + HX5DE[i][3] +"</td>"
                        + "<td>" + HX5DE[i][4] +"</td>"
                        + "</tr>"
                    }

                    temp_html += "</tbody></table>"

                    if (HX5DE.length>0){
                        layer.open({
                            type: 1, 
                            area: '800px',
                            title: HX5DE[0][1]+"的预定情况",
                            content: temp_html
                        });
                    }
                    else{
                        layer.open({
                            type: 1, 
                            title: "提示",
                            content: "<p>该场地目前无人预定</p>"
                        });
                    }

                }
            }
            xmlhttp.send("");


        }

        bookit = function(idid, fname){
            console.log(idid. fname)
            console.log(111111)
            temp_html = "<div style=\"padding: 20px;text-align: center\">"
            temp_html += "<div class=\"layui-inline\"><p>起始时间</p><input type=\"text\" class=\"layui-input\" id=\"MSYCIU\"></div><br>"
            + "<div class=\"layui-inline\"><p>结束时间</p><input type=\"text\" class=\"layui-input\" id=\"UCYENS\"></div><br><br>"
            + "<button class=\"layui-btn\" onclick=\"alert(111)\">确定</button>"
            + "</div>"


            layer.open({
                type: 1, 
                area: '500px',
                title: "预定"+fname,
                content: temp_html
            });

            //刷新时间控件
            layui.use('laydate', function(){
                var laydate = layui.laydate;
                laydate.render({
                    elem: '#MSYCIU'
                    ,type: 'datetime'
                });
            });
            layui.use('laydate', function(){
                var laydate = layui.laydate;
                laydate.render({
                    elem: '#UCYENS'
                    ,type: 'datetime'
                });
            });
            layui.use('element', function() {
                var element = layui.element;
                element.init();
            });
        }



        setTimeout("latest()", 100)
        setTimeout("summary()", 200)
    </script> 



</body>
</html>